<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- تعريف التقرير -->
    <record id="action_report_brandat_sale" model="ir.actions.report">
        <field name="name">طباعة الفاتورة</field>
        <field name="model">brandat.sale</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">brandat_product.report_brandat_sale_document</field>
        <field name="report_file">brandat_product.report_brandat_sale_document</field>
        <field name="binding_model_id" ref="model_brandat_sale"/>
        <field name="binding_type">report</field>
        <field name="print_report_name">'فاتورة_%s' % (object.name)</field>
    </record>

    <!-- قالب الفاتورة الرئيسي -->
    <template id="report_brandat_sale_document">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="o">
                <t t-call="brandat_product.brandat_sale_document_layout">
                    <!-- محتوى الفاتورة -->
                    <div class="page">
                        <!-- رأس الفاتورة -->
                        <div class="row" style="border-bottom: 3px solid #2c3e50; padding-bottom: 15px; margin-bottom: 20px;">
                            <!-- شعار الشركة -->
                            <div class="col-4">
                                <t t-set="settings" t-value="o.env['brandat.company.settings'].get_settings()"/>
                                <img t-if="settings.company_logo" 
                                     t-att-src="image_data_uri(settings.company_logo)" 
                                     style="max-height: 100px; max-width: 180px;"/>
                                <h3 t-if="not settings.company_logo" style="color: #2c3e50; margin: 0;">
                                    <t t-esc="settings.company_name"/>
                                </h3>
                            </div>
                            
                            <!-- عنوان الفاتورة -->
                            <div class="col-4 text-center">
                                <h2 style="color: #e74c3c; margin: 0; font-weight: bold;">فاتورة بيع</h2>
                                <h3 style="color: #e74c3c; margin: 5px 0;">SALES INVOICE</h3>
                            </div>
                            
                            <!-- رقم الفاتورة والتاريخ -->
                            <div class="col-4 text-right">
                                <div style="background: #ecf0f1; padding: 10px; border-radius: 5px;">
                                    <p style="margin: 5px 0;"><strong>رقم الفاتورة:</strong> <t t-esc="o.name"/></p>
                                    <p style="margin: 5px 0;"><strong>التاريخ:</strong> <t t-esc="o.date.strftime('%Y-%m-%d')"/></p>
                                    <p style="margin: 5px 0;"><strong>الفرع:</strong> <t t-esc="o.store_id.name"/></p>
                                </div>
                            </div>
                        </div>

                        <!-- معلومات الشركة والعميل -->
                        <div class="row" style="margin-bottom: 30px;">
                            <!-- معلومات الشركة -->
                            <div class="col-6">
                                <div style="border: 1px solid #bdc3c7; padding: 15px; border-radius: 5px; height: 100%;">
                                    <h4 style="color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 5px; margin-bottom: 10px;">
                                        معلومات الشركة
                                    </h4>
                                    <p style="margin: 5px 0;"><strong>الاسم:</strong> <t t-esc="settings.company_name"/></p>
                                    <p style="margin: 5px 0;"><strong>الهاتف:</strong> <t t-esc="settings.phone1"/></p>
                                    <p t-if="settings.phone2" style="margin: 5px 0;"><strong>هاتف 2:</strong> <t t-esc="settings.phone2"/></p>
                                    <p style="margin: 5px 0;"><strong>البريد:</strong> <t t-esc="settings.email"/></p>
                                    <p t-if="settings.tax_number" style="margin: 5px 0;"><strong>الرقم الضريبي:</strong> <t t-esc="settings.tax_number"/></p>
                                    <p style="margin: 5px 0;"><strong>العنوان:</strong> <t t-esc="settings.address_ar"/></p>
                                </div>
                            </div>
                            
                            <!-- معلومات العميل -->
                            <div class="col-6">
                                <div style="border: 1px solid #bdc3c7; padding: 15px; border-radius: 5px; height: 100%;">
                                    <h4 style="color: #2c3e50; border-bottom: 2px solid #e74c3c; padding-bottom: 5px; margin-bottom: 10px;">
                                        معلومات العميل
                                    </h4>
                                    <t t-if="o.customer_id">
                                        <p style="margin: 5px 0;"><strong>الاسم:</strong> <t t-esc="o.customer_id.name"/></p>
                                        <p t-if="o.customer_id.phone" style="margin: 5px 0;"><strong>الهاتف:</strong> <t t-esc="o.customer_id.phone"/></p>
                                        <p t-if="o.customer_id.mobile" style="margin: 5px 0;"><strong>الموبايل:</strong> <t t-esc="o.customer_id.mobile"/></p>
                                        <p t-if="o.customer_id.email" style="margin: 5px 0;"><strong>البريد:</strong> <t t-esc="o.customer_id.email"/></p>
                                        <p t-if="o.customer_id.address" style="margin: 5px 0;"><strong>العنوان:</strong> <t t-esc="o.customer_id.address"/></p>
                                        <p style="margin: 5px 0;"><strong>نقاط الولاء:</strong> <t t-esc="'%.2f' % o.customer_id.loyalty_points"/> نقطة</p>
                                    </t>
                                    <t t-if="o.partner_id and not o.customer_id">
                                        <p style="margin: 5px 0;"><strong>الاسم:</strong> <t t-esc="o.partner_id.name"/></p>
                                        <p t-if="o.partner_id.phone" style="margin: 5px 0;"><strong>الهاتف:</strong> <t t-esc="o.partner_id.phone"/></p>
                                        <p t-if="o.partner_id.email" style="margin: 5px 0;"><strong>البريد:</strong> <t t-esc="o.partner_id.email"/></p>
                                    </t>
                                    <t t-if="not o.customer_id and not o.partner_id">
                                        <p style="margin: 5px 0; color: #7f8c8d;">عميل نقدي</p>
                                    </t>
                                </div>
                            </div>
                        </div>

                        <!-- جدول المنتجات -->
                        <table class="table table-bordered" style="margin-bottom: 20px;">
                            <thead style="background: #34495e; color: white;">
                                <tr>
                                    <th style="text-align: center; padding: 10px;">#</th>
                                    <th style="padding: 10px;">المنتج</th>
                                    <th style="text-align: center; padding: 10px;">المقاس</th>
                                    <th style="text-align: center; padding: 10px;">اللون</th>
                                    <th style="text-align: center; padding: 10px;">الكمية</th>
                                    <th style="text-align: right; padding: 10px;">السعر</th>
                                    <th style="text-align: right; padding: 10px;">الإجمالي</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-set="line_num" t-value="0"/>
                                <tr t-foreach="o.line_ids" t-as="line">
                                    <t t-set="line_num" t-value="line_num + 1"/>
                                    <td style="text-align: center; padding: 8px;"><t t-esc="line_num"/></td>
                                    <td style="padding: 8px;"><t t-esc="line.product_id.name"/></td>
                                    <td style="text-align: center; padding: 8px;"><t t-esc="line.size_id.name"/></td>
                                    <td style="text-align: center; padding: 8px;"><t t-esc="line.color_id.name"/></td>
                                    <td style="text-align: center; padding: 8px;"><t t-esc="line.quantity"/></td>
                                    <td style="text-align: right; padding: 8px;"><t t-esc="'%.2f' % line.price_unit"/> جنيه</td>
                                    <td style="text-align: right; padding: 8px; font-weight: bold;"><t t-esc="'%.2f' % line.price_subtotal"/> جنيه</td>
                                </tr>
                            </tbody>
                        </table>

                        <!-- الإجماليات -->
                        <div class="row">
                            <div class="col-7">
                                <!-- ملاحظات -->
                                <div t-if="o.notes" style="border: 1px solid #bdc3c7; padding: 10px; border-radius: 5px;">
                                    <h5 style="color: #2c3e50; margin-top: 0;">ملاحظات:</h5>
                                    <p style="margin: 0; white-space: pre-line;"><t t-esc="o.notes"/></p>
                                </div>
                            </div>
                            
                            <div class="col-5">
                                <table class="table" style="margin-bottom: 0;">
                                    <tr>
                                        <td style="text-align: right; padding: 8px; border-top: 1px solid #bdc3c7;"><strong>الإجمالي قبل الخصم:</strong></td>
                                        <td style="text-align: right; padding: 8px; border-top: 1px solid #bdc3c7;"><t t-esc="'%.2f' % o.amount_untaxed"/> جنيه</td>
                                    </tr>
                                    <tr t-if="o.discount_amount > 0">
                                        <td style="text-align: right; padding: 8px; color: #e74c3c;"><strong>الخصم:</strong></td>
                                        <td style="text-align: right; padding: 8px; color: #e74c3c;">- <t t-esc="'%.2f' % o.discount_amount"/> جنيه</td>
                                    </tr>
                                    <tr style="background: #2c3e50; color: white;">
                                        <td style="text-align: right; padding: 12px; font-size: 16px;"><strong>الإجمالي النهائي:</strong></td>
                                        <td style="text-align: right; padding: 12px; font-size: 18px; font-weight: bold;"><t t-esc="'%.2f' % o.amount_total"/> جنيه</td>
                                    </tr>
                                </table>
                            </div>
                        </div>

                        <!-- الشروط والأحكام -->
                        <div style="margin-top: 30px; border-top: 2px solid #ecf0f1; padding-top: 15px;">
                            <h5 style="color: #2c3e50;">الشروط والأحكام:</h5>
                            <p style="white-space: pre-line; color: #7f8c8d; font-size: 12px;">
                                <t t-esc="settings.terms_and_conditions"/>
                            </p>
                        </div>

                        <!-- التوقيع والختم -->
                        <div class="row" style="margin-top: 40px;">
                            <div class="col-6 text-center">
                                <div style="border-top: 1px solid #34495e; display: inline-block; padding-top: 5px; min-width: 200px;">
                                    <p style="margin: 0;">توقيع البائع</p>
                                </div>
                            </div>
                            <div class="col-6 text-center">
                                <t t-if="settings.company_stamp and settings.show_stamp">
                                    <img t-att-src="image_data_uri(settings.company_stamp)" 
                                         style="max-height: 80px; margin-bottom: 10px;"/>
                                </t>
                                <div style="border-top: 1px solid #34495e; display: inline-block; padding-top: 5px; min-width: 200px;">
                                    <p style="margin: 0;">ختم الشركة</p>
                                </div>
                            </div>
                        </div>

                        <!-- التذييل -->
                        <div class="text-center" style="margin-top: 30px; padding-top: 15px; border-top: 2px solid #ecf0f1;">
                            <p style="margin: 0; color: #7f8c8d; font-size: 13px;">
                                <t t-esc="settings.invoice_footer"/>
                            </p>
                            <p t-if="settings.website" style="margin: 5px 0; color: #3498db;">
                                <t t-esc="settings.website"/>
                            </p>
                        </div>
                    </div>
                </t>
            </t>
        </t>
    </template>

    <!-- Layout الأساسي -->
    <template id="brandat_sale_document_layout">
        <t t-call="web.external_layout">
            <t t-raw="0"/>
        </t>
    </template>
</odoo>